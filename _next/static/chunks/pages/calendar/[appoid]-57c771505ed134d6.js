(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[607],{2339:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/calendar/[appoid]",function(){return t(4655)}])},1292:function(e,a,t){"use strict";t.d(a,{v:function(){return u}});var n=t(5893),l=t(1664),s=t.n(l),i=t(7294);let o=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:e.size,height:e.size,fill:e.fill,children:(0,n.jsx)("path",{d:"M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.753 18.305c-.261-.586-.789-.991-1.871-1.241-2.293-.529-4.428-.993-3.393-2.945 3.145-5.942.833-9.119-2.489-9.119-3.388 0-5.644 3.299-2.489 9.119 1.066 1.964-1.148 2.427-3.393 2.945-1.084.25-1.608.658-1.867 1.246-1.405-1.723-2.251-3.919-2.251-6.31 0-5.514 4.486-10 10-10s10 4.486 10 10c0 2.389-.845 4.583-2.247 6.305z"})});var c=t(7251),r=t(2038),d=t.n(r);let u=e=>{let{user:a}=e,[t,l]=(0,i.useState)(!1),r=()=>{l(!0)},u=()=>{l(!1)},p=async()=>{confirm("ログアウトしますか？")&&await (0,c.k)()};return(0,n.jsx)("div",{className:d().container,children:(0,n.jsxs)("div",{className:d().main,children:[(0,n.jsx)(s(),{href:"http://localhost:3000/",children:(0,n.jsx)("div",{className:d().maintitle,children:"連絡あんてな"})}),(0,n.jsxs)("div",{className:d().users,children:[a?(0,n.jsxs)("div",{className:d().userBtn,onMouseEnter:r,onMouseLeave:u,style:{marginTop:t?"76px":"0"},onClick:()=>{l(!t)},children:[(null==a?void 0:a.photoURL)!==void 0?(0,n.jsx)("img",{className:d().userIcon,src:a.photoURL,height:24,alt:a.displayName}):(0,n.jsx)(o,{size:18,fill:"#555"}),(0,n.jsx)("span",{className:d().userName,children:null==a?void 0:a.displayName}),(0,n.jsx)("span",{className:d().dropdownIcon,children:t?"▲":"▼"})]}):(0,n.jsx)(s(),{href:"/login",children:(0,n.jsxs)("div",{className:d().userBtn,children:[(0,n.jsx)(o,{size:18,fill:"#555"}),(0,n.jsx)("span",{className:d().userName,children:"ログイン/新規作成"})]})}),t&&(0,n.jsxs)("div",{className:d().dropdown,onMouseEnter:r,onMouseLeave:u,children:[(0,n.jsx)(s(),{href:"/mypage",children:(0,n.jsx)("div",{className:d().dropdownItem,children:"マイページ"})}),(0,n.jsx)("div",{className:d().dropdownItem,onClick:p,children:"ログアウト"})]})]})]})})}},4655:function(e,a,t){"use strict";t.r(a);var n=t(5893),l=t(8583),s=t(1163),i=t(7294),o=t(1292),c=t(3376),r=t(5371),d=t(6529),u=t.n(d);a.default=()=>{let e=(0,s.useRouter)(),[a]=(0,l.KO)(r.L),{appoid:t}=e.query,[d,p]=(0,i.useState)(),[_,m]=(0,i.useState)(!0),[h,v]=(0,i.useState)(""),[x,N]=(0,i.useState)("google"),[f,j]=(0,i.useState)(""),[w,g]=(0,i.useState)(""),[E,S]=(0,i.useState)(""),[b,T]=(0,i.useState)(""),[y,I]=(0,i.useState)(""),[B,D]=(0,i.useState)(""),[k,C]=(0,i.useState)(""),[H,O]=(0,i.useState)(new Date),[A,R]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=async()=>{if(void 0===t)return;let e=await c.x.calendar.get({query:{appoid:t}}),a=e.body;a&&(j(a.title),g(a.startDate),S(a.endDate),T(a.details),I(a.location),D(a.startTime),C(a.endTime),O(new Date(a.createdAt)),R(a.group),console.log("nowEvent",a),p(a))};e()},[t]);let L=async(e,n)=>{if(void 0===t)return;let l="BEGIN:VEVENT\nSUMMARY:".concat(null==d?void 0:d.title,"\nDTSTART:").concat(null==d?void 0:d.startDate,"T").concat(null==d?void 0:d.startTime,"+0900\nDTEND:").concat(null==d?void 0:d.endDate,"T").concat(null==d?void 0:d.endTime,"+0900\nDESCRIPTION:").concat(null==d?void 0:d.details,"\nLOCATION:").concat(null==d?void 0:d.location,"\nEND:VEVENT\n"),s=encodeURIComponent("BEGIN:VCALENDAR\nVERSION:2.0\n"+l+"END:VCALENDAR");console.log("encodeEvent",s),null!==a&&await c.x.append.post({body:{appoid:t}}),await c.x.calendar.post({body:{appoid:t,title:f,startDate:w,endDate:E,details:b,location:y,startTime:B,endTime:k,createdAt:H.toString(),group:[...A,e]}}),function(e){if(null===localStorage.getItem("recentEvents")){let a=[];a.push(e),localStorage.setItem("recentEvents",JSON.stringify(a));return}let a=JSON.parse(localStorage.getItem("recentEvents"));for(let t=0;t<a.length;t++)if(a[t]===e)return;a.push(e),a.length>5&&a.shift(),localStorage.setItem("recentEvents",JSON.stringify(a))}(JSON.stringify({appoid:t,title:f,location:y,startDate:w,startTime:B,endDate:E,endTime:k})),"google"===n?window.location.href="webcal://pocketcalendar.app/".concat(s):"apple"===n?window.location.href="data:text/calendar;charset=utf-8,".concat(s):"outlook"===n&&window.open("data:text/calendar;charset=utf-8,".concat(s))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.v,{user:a}),(0,n.jsx)("div",{children:"Outlookを選択した場合カレンダーに追加するためのデータをDLします(8KB程)"}),_&&(0,n.jsx)("div",{className:u().popup,children:(0,n.jsxs)("div",{className:u().popupinner,children:[(0,n.jsx)("div",{className:u().popuptitle,children:null==d?void 0:d.title}),(0,n.jsx)("div",{className:u().popuplocation,children:null==d?void 0:d.location}),(0,n.jsxs)("div",{className:u().popupdate,children:[null==d?void 0:d.startDate," ",null==d?void 0:d.startTime," - ",null==d?void 0:d.endDate," ",null==d?void 0:d.endTime]}),(0,n.jsx)("div",{className:u().popupdetails,children:null==d?void 0:d.details}),(0,n.jsx)("div",{className:u().line}),(0,n.jsxs)("div",{className:u().popuptext,children:[(0,n.jsx)("div",{className:u().caution,children:"このイベントをカレンダーに追加しますか？"}),(0,n.jsxs)("div",{className:u().forminput,children:[(0,n.jsx)("label",{className:u().label,htmlFor:"username",children:"ユーザー名"}),(0,n.jsx)("input",{type:"text",className:u().input,id:"username",value:h,onChange:e=>{v(e.target.value)}})]}),(0,n.jsxs)("div",{className:u().forminput,children:[(0,n.jsx)("label",{className:u().label,htmlFor:"calendarType",children:"カレンダーの種類"}),(0,n.jsxs)("select",{className:u().input,id:"calendarType",value:x,onChange:e=>{N(e.target.value)},children:[(0,n.jsx)("option",{value:"google",children:"Googleカレンダー"}),(0,n.jsx)("option",{value:"apple",children:"Appleカレンダー"}),(0,n.jsx)("option",{value:"outlook",children:"Outlookカレンダー"})]})]})]}),(0,n.jsxs)("div",{className:u().popupbutton,children:[(0,n.jsx)("button",{className:u().buttonback,onClick:()=>{m(!1),e.push("/event/".concat(t))},children:"イベントページへ"}),(0,n.jsx)("button",{className:u().button,onClick:()=>{m(!1),L(h,x)},disabled:!h,children:"追加する"})]})]})})]})}},7251:function(e,a,t){"use strict";t.d(a,{_:function(){return i},k:function(){return o}});var n=t(4857),l=t(328),s=t(3377);let i=async()=>{let e=new n.GH;e.addScope("read:user"),await (0,n.rh)((0,l.l)(),e).catch(s.F)},o=async()=>{await (0,l.l)().signOut()}},2038:function(e){e.exports={container:"BasicHeader_container__ASIaK",main:"BasicHeader_main__Vqufr",maintitle:"BasicHeader_maintitle__lyQkx",users:"BasicHeader_users__lGfKJ",userBtn:"BasicHeader_userBtn__wlK48",userIcon:"BasicHeader_userIcon__UecGa",userName:"BasicHeader_userName__KiR1h",dropdownIcon:"BasicHeader_dropdownIcon__CEuaf",dropdown:"BasicHeader_dropdown__H_eKc",dropdownItem:"BasicHeader_dropdownItem__7uCuz"}},6529:function(e){e.exports={popup:"calendar_popup__BC5mE",popupinner:"calendar_popupinner__svatN",popuptitle:"calendar_popuptitle__EBeOd",popuplocation:"calendar_popuplocation__bfHuA",popupdate:"calendar_popupdate__N83Hp",popupdetails:"calendar_popupdetails__YgfSK",popuptext:"calendar_popuptext__Bc_tT",forminput:"calendar_forminput__xd7lT",label:"calendar_label__yhE5I",input:"calendar_input__HyViZ",button:"calendar_button__263BT",buttonback:"calendar_buttonback__7DRQ8",popupbutton:"calendar_popupbutton__0vkZe",line:"calendar_line__9Qq_0",caution:"calendar_caution__iFPbw"}}},function(e){e.O(0,[664,774,888,179],function(){return e(e.s=2339)}),_N_E=e.O()}]);