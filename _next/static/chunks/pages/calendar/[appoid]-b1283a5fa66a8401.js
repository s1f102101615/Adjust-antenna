(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[607],{2339:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/calendar/[appoid]",function(){return a(4655)}])},1292:function(e,t,a){"use strict";a.d(t,{v:function(){return u}});var n=a(5893),s=a(1664),l=a.n(s),i=a(7294);let o=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:e.size,height:e.size,fill:e.fill,children:(0,n.jsx)("path",{d:"M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.753 18.305c-.261-.586-.789-.991-1.871-1.241-2.293-.529-4.428-.993-3.393-2.945 3.145-5.942.833-9.119-2.489-9.119-3.388 0-5.644 3.299-2.489 9.119 1.066 1.964-1.148 2.427-3.393 2.945-1.084.25-1.608.658-1.867 1.246-1.405-1.723-2.251-3.919-2.251-6.31 0-5.514 4.486-10 10-10s10 4.486 10 10c0 2.389-.845 4.583-2.247 6.305z"})});var c=a(7251),r=a(2038),d=a.n(r);let u=e=>{let{user:t}=e,[a,s]=(0,i.useState)(!1),r=()=>{s(!0)},u=()=>{s(!1)},p=async()=>{confirm("Logout?")&&await (0,c.k)()};return(0,n.jsx)("div",{className:d().container,children:(0,n.jsxs)("div",{className:d().main,children:[(0,n.jsx)(l(),{href:"http://localhost:3000/",children:(0,n.jsx)("div",{className:d().maintitle,children:"連絡あんてな"})}),(0,n.jsxs)("div",{className:d().users,children:[t?(0,n.jsxs)("div",{className:d().userBtn,onMouseEnter:r,onMouseLeave:u,style:{marginTop:a?"76px":"0"},onClick:()=>{s(!a)},children:[(null==t?void 0:t.photoURL)!==void 0?(0,n.jsx)("img",{className:d().userIcon,src:t.photoURL,height:24,alt:t.displayName}):(0,n.jsx)(o,{size:18,fill:"#555"}),(0,n.jsx)("span",{className:d().userName,children:null==t?void 0:t.displayName}),(0,n.jsx)("span",{className:d().dropdownIcon,children:a?"▲":"▼"})]}):(0,n.jsx)(l(),{href:"/login",children:(0,n.jsxs)("div",{className:d().userBtn,children:[(0,n.jsx)(o,{size:18,fill:"#555"}),(0,n.jsx)("span",{className:d().userName,children:"ログイン/新規作成"})]})}),a&&(0,n.jsxs)("div",{className:d().dropdown,onMouseEnter:r,onMouseLeave:u,children:[(0,n.jsx)(l(),{href:"/mypage",children:(0,n.jsx)("div",{className:d().dropdownItem,children:"マイページ"})}),(0,n.jsx)("div",{className:d().dropdownItem,onClick:p,children:"ログアウト"})]})]})]})})}},4655:function(e,t,a){"use strict";a.r(t);var n=a(5893),s=a(8583),l=a(1163),i=a(7294),o=a(1292),c=a(3376),r=a(5371),d=a(6529),u=a.n(d);t.default=()=>{let e=(0,l.useRouter)(),[t]=(0,s.KO)(r.L),{appoid:a}=e.query,[d,p]=(0,i.useState)(),[_,m]=(0,i.useState)(!0),[h,v]=(0,i.useState)(""),[N,x]=(0,i.useState)("google"),[f,j]=(0,i.useState)(""),[g,w]=(0,i.useState)(""),[E,S]=(0,i.useState)(""),[T,b]=(0,i.useState)(""),[y,I]=(0,i.useState)(""),[B,D]=(0,i.useState)(""),[k,C]=(0,i.useState)(""),[H,O]=(0,i.useState)(new Date),[A,R]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=async()=>{if(void 0===a)return;let e=await c.x.calendar.get({query:{appoid:a}}),t=e.body;t&&(j(t.title),w(t.startDate),S(t.endDate),b(t.details),I(t.location),D(t.startTime),C(t.endTime),O(new Date(t.createdAt)),R(t.group),console.log("nowEvent",t),p(t))};e()},[a]);let L=async(e,n)=>{if(void 0===a)return;let s="BEGIN:VEVENT\nSUMMARY:".concat(null==d?void 0:d.title,"\nDTSTART:").concat(null==d?void 0:d.startDate,"T").concat(null==d?void 0:d.startTime,"+0900\nDTEND:").concat(null==d?void 0:d.endDate,"T").concat(null==d?void 0:d.endTime,"+0900\nDESCRIPTION:").concat(null==d?void 0:d.details,"\nLOCATION:").concat(null==d?void 0:d.location,"\nEND:VEVENT\n"),l=encodeURIComponent("BEGIN:VCALENDAR\nVERSION:2.0\n"+s+"END:VCALENDAR");console.log("encodeEvent",l),null!==t&&await c.x.append.post({body:{appoid:a}}),await c.x.calendar.post({body:{appoid:a,title:f,startDate:g,endDate:E,details:T,location:y,startTime:B,endTime:k,createdAt:H.toString(),group:[...A,e]}}),function(e){if(null===localStorage.getItem("recentEvents")){let t=[];t.push(e),localStorage.setItem("recentEvents",JSON.stringify(t));return}let t=JSON.parse(localStorage.getItem("recentEvents"));for(let a=0;a<t.length;a++)if(t[a]===e)return;t.push(e),t.length>5&&t.shift(),localStorage.setItem("recentEvents",JSON.stringify(t))}(JSON.stringify({appoid:a,title:f,location:y,startDate:g,startTime:B,endDate:E,endTime:k})),"google"===n||"apple"===n||"outlook"===n&&window.open("data:text/calendar;charset=utf-8,".concat(l))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.v,{user:t}),(0,n.jsx)("div",{children:"Outlookを選択した場合カレンダーに追加するためのデータをDLします(8KB程)"}),_&&(0,n.jsx)("div",{className:u().popup,children:(0,n.jsxs)("div",{className:u().popupinner,children:[(0,n.jsx)("div",{className:u().popuptitle,children:null==d?void 0:d.title}),(0,n.jsx)("div",{className:u().popuplocation,children:null==d?void 0:d.location}),(0,n.jsxs)("div",{className:u().popupdate,children:[null==d?void 0:d.startDate," ",null==d?void 0:d.startTime," - ",null==d?void 0:d.endDate," ",null==d?void 0:d.endTime]}),(0,n.jsx)("div",{className:u().popupdetails,children:null==d?void 0:d.details}),(0,n.jsx)("div",{className:u().line}),(0,n.jsxs)("div",{className:u().popuptext,children:[(0,n.jsx)("div",{className:u().caution,children:"このイベントをカレンダーに追加しますか？"}),(0,n.jsxs)("div",{className:u().forminput,children:[(0,n.jsx)("label",{className:u().label,htmlFor:"username",children:"ユーザー名"}),(0,n.jsx)("input",{type:"text",className:u().input,id:"username",value:h,onChange:e=>{v(e.target.value)}})]}),(0,n.jsxs)("div",{className:u().forminput,children:[(0,n.jsx)("label",{className:u().label,htmlFor:"calendarType",children:"カレンダーの種類"}),(0,n.jsxs)("select",{className:u().input,id:"calendarType",value:N,onChange:e=>{x(e.target.value)},children:[(0,n.jsx)("option",{value:"google",children:"Googleカレンダー"}),(0,n.jsx)("option",{value:"apple",children:"Appleカレンダー"}),(0,n.jsx)("option",{value:"outlook",children:"Outlookカレンダー"})]})]})]}),(0,n.jsxs)("div",{className:u().popupbutton,children:[(0,n.jsx)("button",{className:u().buttonback,onClick:()=>{m(!1),e.push("/event/".concat(a))},children:"イベントページへ"}),(0,n.jsx)("button",{className:u().button,onClick:()=>{m(!1),L(h,N)},children:"追加する"})]})]})})]})}},7251:function(e,t,a){"use strict";a.d(t,{_:function(){return i},k:function(){return o}});var n=a(4857),s=a(328),l=a(3377);let i=async()=>{let e=new n.GH;e.addScope("read:user"),await (0,n.rh)((0,s.l)(),e).catch(l.F)},o=async()=>{await (0,s.l)().signOut()}},2038:function(e){e.exports={container:"BasicHeader_container__ASIaK",main:"BasicHeader_main__Vqufr",maintitle:"BasicHeader_maintitle__lyQkx",users:"BasicHeader_users__lGfKJ",userBtn:"BasicHeader_userBtn__wlK48",userIcon:"BasicHeader_userIcon__UecGa",userName:"BasicHeader_userName__KiR1h",dropdownIcon:"BasicHeader_dropdownIcon__CEuaf",dropdown:"BasicHeader_dropdown__H_eKc",dropdownItem:"BasicHeader_dropdownItem__7uCuz"}},6529:function(e){e.exports={popup:"calendar_popup__BC5mE",popupinner:"calendar_popupinner__svatN",popuptitle:"calendar_popuptitle__EBeOd",popuplocation:"calendar_popuplocation__bfHuA",popupdate:"calendar_popupdate__N83Hp",popupdetails:"calendar_popupdetails__YgfSK",popuptext:"calendar_popuptext__Bc_tT",forminput:"calendar_forminput__xd7lT",label:"calendar_label__yhE5I",input:"calendar_input__HyViZ",button:"calendar_button__263BT",buttonback:"calendar_buttonback__7DRQ8",popupbutton:"calendar_popupbutton__0vkZe",line:"calendar_line__9Qq_0",caution:"calendar_caution__iFPbw"}}},function(e){e.O(0,[664,774,888,179],function(){return e(e.s=2339)}),_N_E=e.O()}]);